# Python, flask and various api code imports
import logging
import cv2
import numpy as np

from predict_client.prod_client import PredictClient


# Logger initialization
# This must happen before any calls to debug(), info(), etc.
logging.basicConfig(level=logging.DEBUG,
                    format='%(asctime)s - %(levelname)s - %(name)s - %(message)s')

# In each file/module, do this to get the module name in the logs
logger = logging.getLogger(__name__)

host = 'localhost:9000'
model_name = 'mnist'
model_version = 1

mnist_client = PredictClient(host, model_name, model_version)

for i in range(10):
    print(i + 1)
    img = cv2.imread('../testSample/img_' + str(i+1) + '.jpg', 0)
    img = np.resize(img, (28, 28, 1))

    ''' Return value will be None if model not running on host '''
    prediction = mnist_client.predict(np.array([img]))

    logger.info('Prediction of length: ' + str(len(prediction)))
    logger.info('Predictions: ' + str(prediction))
    logger.info('Predicted class: ' + str(np.argmax(prediction)))


'''

2017-10-06 10:37:31,672 - INFO - predict_client.prod_client - Got scores with len: 10
2017-10-06 10:37:31,672 - INFO - __main__ - Prediction of length: 10
2017-10-06 10:37:31,673 - INFO - __main__ - Predictions: [-297.1620788574219, -205.40908813476562,
78.79408264160156, -95.28012084960938,
-286.4146423339844, 82.43513488769531,
137.82362365722656, -180.79830932617188,
110.62623596191406, -226.9962615966797]
2017-10-06 10:37:31,673 - INFO - __main__ - Correct class: 6

[[[195]
  [102]
  [121]
  [127]
  [127]
  [124]
  [122]
  [116]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]]

 [[125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]]

 [[125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]]

 [[125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]]

 [[125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [125]
  [129]
  [106]
  [  2]
  [  6]
  [  3]
  [  2]
  [  2]
  [  6]
  [  5]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [122]
  [  8]
  [  3]
  [  0]
  [  0]
  [  0]
  [  4]
  [  4]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]]

 [[  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]]

 [[  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]]

 [[  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]]

 [[  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  5]
  [  3]
  [118]
  [  2]
  [  0]
  [  0]
  [  3]]

 [[  2]
  [  2]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  1]
  [121]
  [  3]
  [  0]
  [  4]
  [  9]
  [  6]
  [  3]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]]

 [[  2]
  [125]
  [  3]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  0]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]]

 [[  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]]

 [[  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]]

 [[  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]]

 [[  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  1]
  [  2]
  [129]
  [  7]
  [  1]
  [  3]
  [  4]
  [  0]
  [  0]
  [  5]
  [  0]
  [  0]]]
'''